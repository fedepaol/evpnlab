name: evpnl3

topology:
  nodes:
    borderleaf:
      kind: cumulus_cvx
      image: networkop/cx:5.3.0
      runtime: docker
      cpu: 1.5
      memory: 2g
      binds:
        - borderleaf/interfaces:/etc/network/interfaces
        - borderleaf/frr.conf:/etc/frr/frr.conf
        - borderleaf/daemons:/etc/frr/daemons
    storageleaf:
      kind: cumulus_cvx
      image: networkop/cx:5.3.0
      runtime: docker
      cpu: 1.5
      memory: 2g
      binds:
        - storageleaf/interfaces:/etc/network/interfaces
        - storageleaf/frr.conf:/etc/frr/frr.conf
        - storageleaf/daemons:/etc/frr/daemons
    leaf1:
      kind: cumulus_cvx
      image: networkop/cx:5.3.0
      runtime: docker
      cpu: 1.5
      memory: 2g
      binds:
        - leaf1/interfaces:/etc/network/interfaces
        - leaf1/frr.conf:/etc/frr/frr.conf
        - leaf1/daemons:/etc/frr/daemons
    leaf2:
      kind: cumulus_cvx
      image: networkop/cx:5.3.0
      runtime: docker
      cpu: 1.5
      memory: 2g
      binds:
        - leaf2/interfaces:/etc/network/interfaces
        - leaf2/frr.conf:/etc/frr/frr.conf
        - leaf2/daemons:/etc/frr/daemons
    spine:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      cpu: 0.5
      memory: 512m
      binds:
        - spine/:/etc/frr/
        - spine/setup.sh:/setup.sh

    SERVER1:
      kind: bridge

    SERVER2:
      kind: linux
      image: praqma/network-multitool:latest
      cpu: 0.25
      memory: 256m
      binds:
        - SERVER2/setup.sh:/setup.sh
      cmd: bash /setup.sh

    SERVER3:
      kind: linux
      image: praqma/network-multitool:latest
      cpu: 0.25
      memory: 256m
      binds:
        - SERVER3/setup.sh:/setup.sh
      cmd: bash /setup.sh

    STORAGE:
      kind: linux
      image: praqma/network-multitool:latest
      cpu: 0.25
      memory: 256m
      binds:
        - STORAGE/setup.sh:/setup.sh
      cmd: bash /setup.sh

    INTERNET:
      kind: linux
      image: praqma/network-multitool:latest
      cpu: 0.25
      memory: 256m
      binds:
        - INTERNET/setup.sh:/setup.sh
      cmd: bash /setup.sh

  links:
    - endpoints: ["STORAGE:eth1", "storageleaf:swp1"]
    - endpoints: ["storageleaf:swp2", "spine:tostorageleaf"]
    - endpoints: ["SERVER1:eth1", "leaf1:swp1"]
    - endpoints: ["leaf1:swp2", "spine:toleaf1"]
    - endpoints: ["SERVER2:eth1", "leaf2:swp1"]
    - endpoints: ["SERVER3:eth1", "leaf2:swp2"]
    - endpoints: ["leaf2:swp3", "spine:toleaf2"]
    - endpoints: ["borderleaf:swp1", "spine:toborderleaf"]
    - endpoints: ["INTERNET:toborder", "borderleaf:swp2"]
