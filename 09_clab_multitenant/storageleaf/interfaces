# The loopback network interface
auto lo
iface lo inet loopback
    address 100.64.0.3/32
    vxlan-local-tunnelip 100.64.0.3

# Management interface
auto eth0
iface eth0 inet dhcp
    vrf mgmt

auto mgmt
iface mgmt
    vrf-table auto

# Spine-facing interface
auto swp2
iface swp2
    address 10.0.0.1/31

# Storage-facing interface
auto swp1
iface swp1
    address 10.1.0.6/31
    vrf vrfstorage

# VRF definitions
auto red
iface red
    vrf-table auto

auto blue
iface blue
    vrf-table auto

auto vrfstorage
iface vrfstorage
    vrf-table auto

auto external
iface external
    vrf-table auto

# L3VNI SVIs (one per VRF)
auto vlan100_l3
iface vlan100_l3
    vrf red
    vlan-raw-device br_l3vni
    vlan-id 100

auto vlan200_l3
iface vlan200_l3
    vrf blue
    vlan-raw-device br_l3vni
    vlan-id 200

auto vlan300_l3
iface vlan300_l3
    vrf vrfstorage
    vlan-raw-device br_l3vni
    vlan-id 300

auto vlan400_l3
iface vlan400_l3
    vrf external
    vlan-raw-device br_l3vni
    vlan-id 400

# Single VXLAN interface with VNI filtering
auto vxlan99
iface vxlan99
    bridge-vlan-vni-map 100=100 200=200 300=300 400=400
    bridge-learning off

# Single L3VNI bridge
auto br_l3vni
iface br_l3vni
    bridge-ports vxlan99
    hwaddress aa:bb:cc:00:00:23
    bridge-vlan-aware yes
